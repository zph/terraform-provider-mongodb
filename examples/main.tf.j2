//////////////////////////////////
//
// DO NOT EDIT
// Autogenerated by terraform-generator.ts
//
//////////////////////////////////
terraform {
  required_version = ">= 0.13"

  required_providers {
    mongodb = {
      source = "registry.terraform.io/Kaginari/mongodb"
      version = "9.9.9"
    }
  }
}

{% for node in nodes %}
provider "mongodb" {
  alias = "{{node.name}}"
  host = "{{node.host}}"
  port = "{{node.port}}"
  # TODO: lift out as AWS Secrets Manager reference blocks
  username = "{{node.userAdmin}}"
  password = "{{node.userAdminPassword}}"
  ssl = false
  auth_database = "admin"
}
{% endfor %}

{%- for node in nodes %}
//////////////////////////////
// START {{node.name}}
//////////////////////////////
module "{{node.name}}_roles" {
  source = "./modules/roles"
  providers = {
    mongodb = mongodb.{{node.name}}
  }
}
  {% for user in users %}
module "{{node.name}}_user_{{ user.name }}" {
  depends_on = [ module.{{node.name}}_roles ]
  source = "./modules/user"
  username = "{{user.name}}"
  password = "{{user.password}}"
  providers = {
    mongodb = mongodb.{{node.name}}
  }
}
  {% endfor %}
//////////////////////////////
// END {{node.name}}
//////////////////////////////
{% endfor %}
